{
  "$schema": "./config_schema.json",
  "servo": {
    "model": "MX-64",
    "operating_mode": 4,
    "current_limits": {
      "holding": 50,
      "movement": 100,
      "max": 200,
      "hardware_max": 1359
    },
    "temperature": {
      "warning": 60,
      "advisory": 70,
      "shutdown": 75,
      "hardware_max": 80
    },
    "registers": {
      "operating_mode": 11,
      "torque_enable": 64,
      "current_limit": 38,
      "profile_velocity": 112,
      "goal_current": 102,
      "goal_position": 116,
      "present_position": 132,
      "present_temperature": 146,
      "present_current": 126,
      "present_voltage": 144,
      "hardware_error": 70,
      "return_delay_time": 9,
      "status_return_level": 68
    },
    "performance": {
      "max_current_limit": 1600,
      "max_profile_velocity": 1023
    },
    "eeprom_settings": {
      "return_delay_time": 0,
      "status_return_level": 1
    },
    "dynamixel_settings": {
      "operating_mode": 4,
      "current_limit": 1600,
      "velocity_limit": 1023,
      "profile_velocity": 0,
      "profile_acceleration": 0,
      "return_delay_time": 2,
      "status_return_level": 2
    },
    "force_management": {
      "moving_force_pct": 10,
      "holding_force_pct": 10,
      "contact_force_pct": 10,
      "idle_force_pct": 0
    },
    "collision_detection": {
      "enabled": true,
      "current_spike_threshold_pct": 25,
      "stagnation_movement_units": 0.5,
      "consecutive_samples_required": 2,
      "stall_tolerance_pct": 1.0,
      "_comment_stall_tolerance": "Percentage tolerance for stall detection. Servo range: 2500 ticks = 100%, resolution: 1 tick = 0.04%. Value of 1.0% = 25 ticks. If 3 consecutive positions are all within 25 ticks of each other (max-min < 1.0%), they are considered the same position (stalled).",
      "zero_target_tolerance_pct": 0.04,
      "_comment_zero_tolerance": "Tight tolerance for detecting stable position at target 0%. Value of 0.04% = 1 tick. Used to trigger GRASPING when fully closed.",
      "obstacle_error_threshold_pct": 5.0,
      "_comment_obstacle_threshold": "Position error threshold for obstacle detection. If position stagnant and >5% from target, obstacle detected.",
      "position_change_threshold_pct": 1.0,
      "_comment_position_change": "Threshold for state transitions. Position must change by >1% to trigger state change.",
      "command_change_threshold_pct": 3.0,
      "_comment_command_change": "Threshold for sending new servo commands. Only send if position changes by >3%.",
      "monitor_frequency_hz": 30
    }
  },
  "gripper": {
    "grip_max": 2500,
    "position_scaling": {
      "input_range": [0, 100],
      "output_range": [0, 100]
    },
    "dex1_mapping": {
      "close_radians": 0.0,
      "open_radians": 5.4
    },
    "calibration": {
      "goto_position_target": -300,
      "goto_position_effort": 30,
      "settle_position": 50,
      "auto_on_init": true
    }
  },
  "communication": {
    "device": "/dev/ttyUSB0",
    "baudrate": 1000000,
    "protocol_version": 2.0,
    "servo_id": 1,
    "timeout": 0.5,
    "smart_init": true
  },
  "telemetry": {
    "enabled": true,
    "topic_prefix": "rt/gripper",
    "rate_hz": 30,
    "qos_reliability": "RELIABLE",
    "debug_enabled": false,
    "debug_topic_prefix": "rt/gripper/debug"
  },
  "logging": {
    "enabled": true,
    "level": "INFO",
    "log_errors": true,
    "log_temperature": true,
    "log_current": false,
    "log_file": "/var/log/ezgripper.log",
    "max_log_size_mb": 100
  }
}

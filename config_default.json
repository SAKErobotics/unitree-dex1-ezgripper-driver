{
  "$schema": "./config_schema.json",
  "_comment": "EZGripper Configuration - Cleaned and organized. Only contains settings that are actually used by the code.",
  
  "servo": {
    "_comment": "Dynamixel MX-64 servo configuration",
    
    "dynamixel_settings": {
      "_comment": "Hardware settings applied to servo during initialization via ezgripper_base_clean.py:_setup_position_control()",
      "operating_mode": 5,
      "_comment_operating_mode": "Mode 5: Current-based Position Control - PID outputs desired current, current controller manages torque. Critical for gripper with spring force. ROBOTIS RH-P12-RN uses Mode 5 exclusively.",
      "current_limit": 1600,
      "_comment_current_limit": "Maximum current in units (1600 × 3.36mA = 5376mA). Goal Current from force_pct limits desired current.",
      "velocity_limit": 1023,
      "_comment_velocity_limit": "Maximum velocity limit (0-1023 range)",
      "profile_velocity": 500,
      "_comment_profile_velocity": "Profile velocity for smooth movement. 500 = moderate speed with fast profile calculation (eliminates freezing at 30Hz)",
      "profile_acceleration": 800,
      "_comment_profile_acceleration": "Profile acceleration for smooth movement. 800 = near-rectangular profile for fast response",
      "return_delay_time": 2,
      "_comment_return_delay_time": "Return delay time in microseconds (2µs)",
      "status_return_level": 2,
      "_comment_status_return_level": "Status return level: 0=never, 1=only READ, 2=always"
    },
    
    "force_management": {
      "_comment": "Force settings per GraspManager state - used by grasp_manager.py",
      "moving_force_pct": 50,
      "_comment_moving": "Force during MOVING state (closing/opening). 50% × 1600 = 800 units = 2688mA - strong wrapping force",
      "grasping_force_pct": 20.0,
      "_comment_grasping": "Force during GRASPING state (holding after contact). 20% × 1600 = 320 units = 1075mA - prevents backdriving",
      "idle_force_pct": 10,
      "_comment_idle": "Force during IDLE state. 10% × 1600 = 160 units = 538mA - minimal holding force"
    },
    
    "collision_detection": {
      "_comment": "Stall/contact detection settings - used by grasp_manager.py",
      "enabled": true,
      "consecutive_samples_required": 3,
      "_comment_consecutive_samples": "Number of consecutive stagnant readings to confirm contact",
      "stall_tolerance_pct": 2.0,
      "_comment_stall_tolerance": "Position range tolerance for stall detection. 2.0% = 50 ticks. If 3 consecutive positions are within this range, considered stalled.",
      "zero_target_tolerance_pct": 0.04,
      "_comment_zero_tolerance": "Tight tolerance for stable position at 0% target. 0.04% = 1 tick. Triggers GRASPING when fully closed.",
      "position_change_threshold_pct": 1.0,
      "_comment_position_change": "Threshold for state transitions. Position must change >1% to trigger state change.",
      "command_change_threshold_pct": 3.0,
      "_comment_command_change": "Threshold for sending new servo commands. Only send if position changes >3%."
    }
  },
  
  "gripper": {
    "_comment": "Gripper geometry and calibration settings",
    "grip_max": 2500,
    "_comment_grip_max": "Maximum position range in servo units (0-2500 for practical range, MX-64 supports 0-4095)",
    
    "position_scaling": {
      "max_open_percent": 100,
      "_comment": "Maximum opening percentage. 100% GUI command → max_open_percent hardware output. 0% always → fully closed."
    },
    
    "dex1_mapping": {
      "_comment": "Mapping to Unitree Dex1 hand radians for DDS interface",
      "close_radians": 0.0,
      "open_radians": 5.4,
      "_comment_mapping": "0.0 rad = trigger released (gripper open), 5.4 rad = trigger squeezed (gripper closed). Inverted in driver to match user expectations."
    },
    
    "calibration": {
      "_comment": "Calibration sequence settings - used by ezgripper_dds_driver.py",
      "goto_position_target": -300,
      "_comment_goto_target": "Target position for calibration goto sequence. Negative ensures full range movement.",
      "goto_position_effort": 30,
      "_comment_goto_effort": "Effort level for calibration. Moderate force to overcome resistance.",
      "settle_position": 35,
      "_comment_settle_position": "Position after calibration. Middle of typical range.",
      "auto_on_init": true,
      "_comment_auto_calib": "Automatically run calibration on driver initialization."
    }
  },
  
  "communication": {
    "_comment": "Serial communication settings - used by lib_robotis.py",
    "device": "/dev/ttyUSB0",
    "baudrate": 1000000,
    "protocol_version": 2.0,
    "servo_id": 1,
    "timeout": 0.5,
    "smart_init": true,
    "_comment_smart_init": "Enable smart initialization with automatic device detection and error recovery."
  },
  
  "telemetry": {
    "_comment": "Telemetry publishing settings - used by ezgripper_dds_driver.py",
    "enabled": true,
    "topic_prefix": "rt/gripper",
    "rate_hz": 30,
    "_comment_rate": "Telemetry publish rate. 30Hz matches control loop frequency.",
    "qos_reliability": "RELIABLE",
    "debug_enabled": false,
    "debug_topic_prefix": "rt/gripper/debug"
  },
  
  "logging": {
    "_comment": "Logging settings - used by config.py properties",
    "enabled": true,
    "level": "INFO",
    "log_errors": true,
    "log_temperature": true,
    "log_current": false,
    "log_file": "/var/log/ezgripper.log",
    "max_log_size_mb": 100
  }
}